{
  "name": "Note",
  "type": "object",
  "properties": {
    "company_id": {
      "type": "string",
      "description": "ID da imobili\u00e1ria \u00e0 qual a anota\u00e7\u00e3o pertence"
    },
    "is_archived": {
      "type": "boolean",
      "default": false,
      "description": "Se a nota foi arquivada (soft delete)"
    },
    "archived_at": {
      "type": "string",
      "format": "date-time",
      "description": "Data e hora do arquivamento"
    },
    "archived_by": {
      "type": "string",
      "description": "Email do usu\u00e1rio que arquivou"
    },
    "title": {
      "type": "string",
      "description": "T\u00edtulo da anota\u00e7\u00e3o"
    },
    "content": {
      "type": "string",
      "description": "Conte\u00fado da anota\u00e7\u00e3o"
    },
    "note_type": {
      "type": "string",
      "enum": [
        "geral",
        "reuniao",
        "ligacao",
        "visita",
        "negociacao",
        "follow_up"
      ],
      "description": "Tipo da anota\u00e7\u00e3o"
    },
    "priority": {
      "type": "string",
      "enum": [
        "baixa",
        "media",
        "alta",
        "urgente"
      ],
      "default": "media",
      "description": "Prioridade"
    },
    "property_id": {
      "type": "string",
      "description": "ID da propriedade relacionada"
    },
    "client_id": {
      "type": "string",
      "description": "ID do cliente relacionado"
    },
    "deal_id": {
      "type": "string",
      "description": "ID do neg\u00f3cio relacionado"
    },
    "agent_email": {
      "type": "string",
      "description": "Email do corretor"
    },
    "assigned_by": {
      "type": "string",
      "format": "email",
      "description": "Email do admin que atribuiu esta atividade para o agent_email atual"
    },
    "due_date": {
      "type": "string",
      "format": "date-time",
      "description": "Data e hora de vencimento"
    },
    "is_completed": {
      "type": "boolean",
      "default": false,
      "description": "Se foi conclu\u00edda"
    },
    "visit_form_id": {
      "type": "string",
      "description": "ID da ficha de visita associada (preenchida e assinada)"
    },
    "visit_form_status": {
      "type": "string",
      "enum": [
        "pending",
        "draft",
        "signed",
        "sent"
      ],
      "description": "Status da ficha de visita: pendente, rascunho, assinada ou enviada"
    }
  },
  "required": [
    "title",
    "content",
    "note_type"
  ],
  "indexes": [
    {
      "fields": [
        "company_id"
      ]
    },
    {
      "fields": [
        "agent_email"
      ]
    },
    {
      "fields": [
        "assigned_by"
      ]
    },
    {
      "fields": [
        "is_completed"
      ]
    },
    {
      "fields": [
        "due_date"
      ]
    },
    {
      "fields": [
        "updated_date"
      ]
    },
    {
      "fields": [
        "property_id"
      ]
    },
    {
      "fields": [
        "client_id"
      ]
    },
    {
      "fields": [
        "deal_id"
      ]
    },
    {
      "fields": [
        "created_date"
      ]
    },
    {
      "fields": [
        "note_type"
      ]
    },
    {
      "fields": [
        "priority"
      ]
    },
    {
      "fields": [
        "visit_form_id"
      ]
    }
  ],
  "rls": {
    "read": {
      "$or": [
        {
          "data.agent_email": "{{user.email}}"
        },
        {
          "$and": [
            {
              "data.company_id": "{{user.data.company_id}}"
            },
            {
              "user_condition": {
                "role": "admin"
              }
            }
          ]
        },
        {
          "user_condition": {
            "email": "goulartrm@gmail.com"
          }
        }
      ]
    },
    "write": {
      "$or": [
        {
          "data.agent_email": "{{user.email}}"
        },
        {
          "$and": [
            {
              "data.company_id": "{{user.data.company_id}}"
            },
            {
              "user_condition": {
                "role": "admin"
              }
            }
          ]
        },
        {
          "user_condition": {
            "email": "goulartrm@gmail.com"
          }
        }
      ]
    },
    "delete": {
      "$or": [
        {
          "data.agent_email": "{{user.email}}"
        },
        {
          "$and": [
            {
              "data.company_id": "{{user.data.company_id}}"
            },
            {
              "user_condition": {
                "role": "admin"
              }
            }
          ]
        },
        {
          "user_condition": {
            "email": "goulartrm@gmail.com"
          }
        }
      ]
    }
  }
}